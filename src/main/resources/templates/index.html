<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SQL执行器</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .sql-editor {
                font-family: Consolas, Monaco, 'Andale Mono', monospace;
            }
            .result-table {
                @apply min-w-full divide-y divide-gray-200;
            }
            .result-table th {
                @apply px-4 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
            }
            .result-table td {
                @apply px-4 py-2 whitespace-nowrap text-sm text-gray-700;
            }
            .result-table tr:nth-child(even) {
                @apply bg-gray-50;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
<div class="min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                        <span class="text-xl font-bold text-blue-600 flex items-center">
                            <i class="fa fa-database mr-2"></i>
                            SQL执行器
                        </span>
                </div>
            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="flex-grow">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- 消息提示 -->
            <div class="mb-6">
                <div th:if="${message}" class="bg-green-50 border border-green-400 text-green-700 px-4 py-3 rounded relative" role="alert">
                    <strong class="font-bold">成功!</strong>
                    <span class="block sm:inline" th:text="${message}"></span>
                </div>
                <div th:if="${error}" class="bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                    <strong class="font-bold">错误!</strong>
                    <span class="block sm:inline" th:text="${error}"></span>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="flex flex-col md:flex-row">
                    <!-- 左侧面板 - 数据库选择 -->
                    <div class="w-full md:w-64 bg-gray-50 border-r border-gray-200 p-4">
                        <h3 class="text-sm font-semibold text-gray-700 uppercase tracking-wider mb-4">数据库配置</h3>

                        <!-- 已配置的数据库 -->
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-gray-500">已配置的数据库</span>
                                <button id="add-database-btn" class="text-blue-600 hover:text-blue-800 text-xs flex items-center">
                                    <i class="fa fa-plus-circle mr-1"></i> 添加
                                </button>
                            </div>

                            <div class="space-y-1">
                                <a href="#" th:href="@{/switch-database/{name}(name=${configKey})}"
                                   th:each="configKey : ${databaseConfigs.keySet()}"
                                   th:text="${configKey + ' (' + (databaseConfigs[configKey]?.databaseName ?: '未知数据库') + ')'}">
                                    default (mysql)
                                </a>
                            </div>
                        </div>

                        <!-- 添加新数据库配置表单 -->
                        <div id="add-database-form" class="hidden mb-6 p-3 bg-white rounded-md border border-gray-200">
                            <h4 class="text-xs font-semibold text-gray-700 uppercase tracking-wider mb-3">添加数据库</h4>

                            <form method="post" action="#" th:action="@{/add-database}" th:object="${databaseConfig}">
                                <div class="mb-2">
                                    <label for="databaseName" class="block text-xs font-medium text-gray-700 mb-1">数据库名称</label>
                                    <input type="text" id="databaseName" th:field="*{databaseName}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                                           placeholder="testdb">
                                    <p th:if="${#fields.hasErrors('databaseName')}" th:errors="*{databaseName}" class="text-red-500 text-xs mt-1"></p>
                                </div>

                                <div class="mb-2">
                                    <label for="username" class="block text-xs font-medium text-gray-700 mb-1">用户名</label>
                                    <input type="text" id="username" th:field="*{username}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                                           placeholder="root">
                                    <p th:if="${#fields.hasErrors('username')}" th:errors="*{username}" class="text-red-500 text-xs mt-1"></p>
                                </div>

                                <div class="mb-2">
                                    <label for="password" class="block text-xs font-medium text-gray-700 mb-1">密码</label>
                                    <input type="password" id="password" th:field="*{password}"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm"
                                           placeholder="password">
                                    <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="text-red-500 text-xs mt-1"></p>
                                </div>

                                <div class="flex justify-end mt-3">
                                    <button type="button" id="cancel-add-database" class="px-3 py-1 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        取消
                                    </button>
                                    <button type="submit" class="ml-2 px-3 py-1 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        添加
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- 服务器上的所有数据库 -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-gray-500">服务器数据库</span>
                            </div>

                            <div class="space-y-1 max-h-40 overflow-y-auto p-1">
                                <a href="#" th:href="@{/switch-database/{name}(name=${database})}"
                                   th:each="database : ${databases}"
                                   class="block px-3 py-2 text-sm text-gray-700 rounded-md hover:bg-gray-100"
                                   th:text="${database}">
                                    information_schema
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧面板 - SQL编辑器和结果 -->
                    <div class="flex-1 p-6">
                        <div class="mb-6">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-lg font-medium text-gray-900">SQL编辑器</h3>
                                <div class="flex space-x-2">
                                    <button id="clear-sql" class="inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <i class="fa fa-eraser mr-1"></i> 清空
                                    </button>
                                    <button id="execute-sql" class="inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <i class="fa fa-play mr-1"></i> 执行
                                    </button>
                                </div>
                            </div>

                            <form method="post" action="#" th:action="@{/execute}" id="sql-form">
                                <div class="mb-3">
                    <textarea id="sql-text" name="sql" rows="8"
                              class="w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sql-editor text-sm"
                              th:text="${sql}"
                              placeholder="输入SQL语句...例如: SELECT * FROM users;"></textarea>
                                </div>

                                <div class="flex items-center">
                                    <select name="database" class="mr-3 border border-gray-300 rounded-md shadow-sm px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500 text-sm">
                                        <option th:each="configKey : ${databaseConfigs.keySet()}"
                                                th:value="${configKey}"
                                                th:selected="${configKey == currentDatabase}"
                                                th:text="${configKey + ' (' + (databaseConfigs[configKey]?.databaseName ?: '未知数据库') + ')'}">
                                            default (mysql)
                                        </option>
                                    </select>

                                    <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <i class="fa fa-play mr-1"></i> 执行SQL
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- 结果区域 -->
                        <div>
                            <h3 class="text-lg font-medium text-gray-900 mb-3">执行结果</h3>

                            <!-- 查询结果表格 -->
                            <div th:if="${result}" class="overflow-x-auto bg-white rounded-md border border-gray-200">
                                <table class="result-table">
                                    <thead>
                                    <tr th:if="${result.size() > 0}">
                                        <th th:each="column : ${#maps.keys(result[0])}" th:text="${column}">ID</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="row : ${result}">
                                        <td th:each="value : ${row.values()}" th:text="${value}">1</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 空状态 -->
                            <!-- 修正后的空状态判断 -->
                            <div class="bg-gray-50 border border-gray-200 rounded-md p-6 text-sm text-gray-600 text-center"
                                 th:unless="${result != null || message != null || error != null}">
                                <i class="fa fa-info-circle mr-1 text-blue-500"></i>
                                <span>执行SQL查询后结果将显示在这里</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 py-6 mt-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <p class="text-center text-sm text-gray-500">
                © 2023 SQL执行器 - 一个简单的数据库管理工具
            </p>
        </div>
    </footer>
</div>

<script>
    // 显示/隐藏添加数据库表单
    document.getElementById('add-database-btn').addEventListener('click', function() {
        document.getElementById('add-database-form').classList.remove('hidden');
    });

    document.getElementById('cancel-add-database').addEventListener('click', function() {
        document.getElementById('add-database-form').classList.add('hidden');
    });

    // 清空SQL编辑器
    document.getElementById('clear-sql').addEventListener('click', function() {
        document.getElementById('sql-text').value = '';
    });

    // 执行SQL
    document.getElementById('execute-sql').addEventListener('click', function() {
        document.getElementById('sql-form').submit();
    });

    // 按Ctrl+Enter执行SQL
    document.getElementById('sql-text').addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            e.preventDefault();
            document.getElementById('sql-form').submit();
        }
    });
</script>
</body>
</html>